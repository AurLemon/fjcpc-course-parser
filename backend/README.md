# FJCPC Course Parser - Rust Backend

ç¦å»ºèˆ¹æ”¿äº¤é€šèŒä¸šå­¦é™¢è¯¾ç¨‹è§£æå™¨ - Rust åç«¯ï¼ˆä½¿ç”¨ Actix-web æ¡†æ¶ï¼‰

## é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ controller/      # æ§åˆ¶å™¨å±‚ï¼ˆå¤„ç† HTTP è¯·æ±‚ï¼‰
â”‚   â”‚   â”œâ”€â”€ course.rs
â”‚   â”‚   â””â”€â”€ mod.rs
â”‚   â”œâ”€â”€ parser/          # è§£æå™¨å±‚ï¼ˆä¸å¤–éƒ¨ API äº¤äº’ï¼‰
â”‚   â”‚   â”œâ”€â”€ auth.rs      # è®¤è¯ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ course.rs    # è¯¾ç¨‹ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ schedule.rs  # è¯¾è¡¨ç›¸å…³
â”‚   â”‚   â””â”€â”€ mod.rs
â”‚   â”œâ”€â”€ routes/          # è·¯ç”±å±‚ï¼ˆURL æ˜ å°„ï¼‰
â”‚   â”‚   â”œâ”€â”€ course.rs
â”‚   â”‚   â””â”€â”€ mod.rs
â”‚   â”œâ”€â”€ services/        # æœåŠ¡å±‚ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
â”‚   â”‚   â”œâ”€â”€ course.rs
â”‚   â”‚   â””â”€â”€ mod.rs
â”‚   â”œâ”€â”€ utils/           # å·¥å…·æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ config.rs    # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ http.rs      # HTTP å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ log.rs       # æ—¥å¿—å·¥å…·
â”‚   â”‚   â”œâ”€â”€ response.rs  # å“åº”æ ¼å¼
â”‚   â”‚   â”œâ”€â”€ schedule.rs  # è¯¾è¡¨å·¥å…·
â”‚   â”‚   â”œâ”€â”€ simulator.rs # æµè§ˆå™¨æ¨¡æ‹Ÿå™¨ï¼ˆå¾…å®Œå–„ï¼‰
â”‚   â”‚   â””â”€â”€ mod.rs
â”‚   â”œâ”€â”€ lib.rs           # åº“å…¥å£
â”‚   â””â”€â”€ main.rs          # ç¨‹åºå…¥å£
â”œâ”€â”€ tests/               # é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ auth_test.rs     # è®¤è¯æµ‹è¯•
â”‚   â”œâ”€â”€ course_test.rs   # è¯¾ç¨‹æµ‹è¯•
â”‚   â””â”€â”€ schedule_test.rs # è¯¾è¡¨æµ‹è¯•
â”œâ”€â”€ .env.example         # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ Cargo.toml           # é¡¹ç›®é…ç½®
â””â”€â”€ README.md            # æœ¬æ–‡ä»¶
```

## åŠŸèƒ½ç‰¹æ€§

- âœ… **é«˜æ€§èƒ½**: ä½¿ç”¨ Rust + Actix-webï¼Œæ€§èƒ½è¿œè¶… Node.js ç‰ˆæœ¬
- âœ… **ç±»å‹å®‰å…¨**: Rust çš„å¼ºç±»å‹ç³»ç»Ÿç¡®ä¿ä»£ç è´¨é‡
- âœ… **å¼‚æ­¥å¹¶å‘**: ä½¿ç”¨ Tokio å¼‚æ­¥è¿è¡Œæ—¶ï¼Œæ”¯æŒé«˜å¹¶å‘
- âœ… **IPv4 å¼ºåˆ¶**: è§£å†³å­¦æ ¡ DNS æœåŠ¡å™¨çš„ AAAA è®°å½•é—®é¢˜
- âœ… **è®¤è¯æœºåˆ¶**: æ”¯æŒ Basic Auth å’Œ Bearer Token
- âš ï¸ **æµè§ˆå™¨æ¨¡æ‹Ÿ**: ç®€åŒ–ç‰ˆå®ç°ï¼ˆå¾…å®Œå–„ï¼‰

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

ç¡®ä¿å·²å®‰è£… Rust å·¥å…·é“¾ï¼š

```bash
# å®‰è£… Rustï¼ˆå¦‚æœå°šæœªå®‰è£…ï¼‰
# è®¿é—® https://rustup.rs/ ä¸‹è½½å®‰è£…

# éªŒè¯å®‰è£…
rustc --version
cargo --version
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ `.env.example` ä¸º `.env` å¹¶å¡«å†™é…ç½®ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```env
COLLEGE_APP_BASE_URL=https://czmobile.fjcpc.edu.cn
TEST_STUDENT_UCODE=your_test_student_ucode_here
```

### 3. ç¼–è¯‘é¡¹ç›®

```bash
# å¼€å‘æ¨¡å¼ç¼–è¯‘
cargo build

# ç”Ÿäº§æ¨¡å¼ç¼–è¯‘ï¼ˆä¼˜åŒ–ï¼‰
cargo build --release
```

### 4. è¿è¡ŒæœåŠ¡å™¨

```bash
# å¼€å‘æ¨¡å¼è¿è¡Œ
cargo run

# ç”Ÿäº§æ¨¡å¼è¿è¡Œ
cargo run --release
```

æœåŠ¡å™¨å°†åœ¨ `http://127.0.0.1:8080` å¯åŠ¨ã€‚

### 5. è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cargo test

# è¿è¡Œç‰¹å®šæµ‹è¯•
cargo test auth_test
cargo test schedule_test
cargo test course_test

# æ˜¾ç¤ºæµ‹è¯•è¾“å‡º
cargo test -- --nocapture
```

## API ç«¯ç‚¹

### GET /api/course

è·å–è¯¾ç¨‹ä¿¡æ¯ï¼ˆå½“å‰ä¸ºæµ‹è¯•ç«¯ç‚¹ï¼‰

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "status": "success",
  "data": {
    "ucode": "NOT_SET"
  },
  "message": "Success"
}
```

## é‡è¦æ³¨é‡Šè¯´æ˜

### 1. æ¨¡æ‹Ÿå™¨é€»è¾‘

ä½äº `src/utils/simulator.rs`ï¼Œè¿™ä¸ªæ¨¡æ‹Ÿå™¨çš„é€»è¾‘è¦å§‹ç»ˆä¿ç•™ã€‚è™½ç„¶å½“å‰æ˜¯ç®€åŒ–ç‰ˆå®ç°ï¼Œä½†æ¡†æ¶å·²ç»æ­å»ºå¥½ï¼Œæœªæ¥å¯ä»¥å®Œå–„ã€‚

**ä¸ºä»€ä¹ˆéœ€è¦æ¨¡æ‹Ÿå™¨ï¼Ÿ**
- å­¦æ ¡ API å¯èƒ½éšæ—¶å˜åŒ–
- é™æ€è®¤è¯å¯èƒ½å¤±æ•ˆ
- éœ€è¦åŠ¨æ€æ•è·çœŸå®çš„è®¤è¯ä¿¡æ¯

### 2. IPv4 å¼ºåˆ¶

ä½äº `src/utils/http.rs`ï¼Œå¼ºåˆ¶ä½¿ç”¨ IPv4 è§£æ DNSã€‚

**åŸå› **: èˆ¹æ”¿é‚£ä¸ªç¥å¿… DNS æœåŠ¡å™¨åŠ äº† AAAA å´æ²¡æ³•è§£æçš„é—®é¢˜ ğŸ˜…

### 3. è®¤è¯ä¸ç¡®å®šæ€§

ä½äº `src/parser/auth.rs`ï¼ŒBasic Auth ä½¿ç”¨ "cat:cat"ã€‚

**æ³¨æ„**: æ ¹æ®æ ¡å†…æœåŠ¡å™¨æ•°æ®æ¨æµ‹ï¼Œå­˜åœ¨ä¸ç¡®å®šæ€§ã€‚å¦‚æœå¤±è´¥ä¼šè‡ªåŠ¨å›é€€åˆ°æµè§ˆå™¨æ¨¡æ‹Ÿã€‚

## ä¸ Node.js ç‰ˆæœ¬çš„å¯¹æ¯”

| ç‰¹æ€§ | Node.js ç‰ˆæœ¬ | Rust ç‰ˆæœ¬ |
|------|-------------|-----------|
| æ€§èƒ½ | ä¸­ç­‰ | é«˜ |
| å†…å­˜å ç”¨ | è¾ƒé«˜ | ä½ |
| ç±»å‹å®‰å…¨ | å¼±ï¼ˆTypeScript å¯é€‰ï¼‰ | å¼º |
| å¹¶å‘æ¨¡å‹ | äº‹ä»¶å¾ªç¯ | å¤šçº¿ç¨‹ + å¼‚æ­¥ |
| æµè§ˆå™¨æ¨¡æ‹Ÿ | Puppeteerï¼ˆå®Œæ•´ï¼‰ | chromiumoxideï¼ˆç®€åŒ–ï¼‰ |
| å¯åŠ¨é€Ÿåº¦ | å¿« | ä¸­ç­‰ |
| ç¼–è¯‘æ—¶é—´ | æ—  | è¾ƒé•¿ |

## å¾…å®Œå–„åŠŸèƒ½

- [ ] å®Œå–„æµè§ˆå™¨æ¨¡æ‹Ÿå™¨ï¼ˆchromiumoxide æˆ– fantocciniï¼‰
- [ ] æ·»åŠ æ›´å¤š API ç«¯ç‚¹
- [ ] å®ç°å®Œæ•´çš„è¯¾ç¨‹æŸ¥è¯¢åŠŸèƒ½
- [ ] æ·»åŠ ç¼“å­˜æœºåˆ¶
- [ ] æ·»åŠ æ›´å¤šå•å…ƒæµ‹è¯•
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•

## æŠ€æœ¯æ ˆ

- **Web æ¡†æ¶**: Actix-web 4.x
- **å¼‚æ­¥è¿è¡Œæ—¶**: Tokio 1.x
- **HTTP å®¢æˆ·ç«¯**: reqwest (rustls-tls)
- **åºåˆ—åŒ–**: serde + serde_json
- **æ—¥å¿—**: tracing + tracing-subscriber
- **é”™è¯¯å¤„ç†**: anyhow + thiserror
- **æµè§ˆå™¨è‡ªåŠ¨åŒ–**: chromiumoxide (å¾…å®Œå–„)

## å¼€å‘å»ºè®®

1. **ä½¿ç”¨ `cargo watch` è‡ªåŠ¨é‡æ–°ç¼–è¯‘**:
   ```bash
   cargo install cargo-watch
   cargo watch -x run
   ```

2. **ä½¿ç”¨ `cargo clippy` æ£€æŸ¥ä»£ç **:
   ```bash
   cargo clippy
   ```

3. **ä½¿ç”¨ `cargo fmt` æ ¼å¼åŒ–ä»£ç **:
   ```bash
   cargo fmt
   ```

4. **æŸ¥çœ‹ä¾èµ–æ ‘**:
   ```bash
   cargo tree
   ```

## è®¸å¯è¯

ä¸ä¸»é¡¹ç›®ä¿æŒä¸€è‡´

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

